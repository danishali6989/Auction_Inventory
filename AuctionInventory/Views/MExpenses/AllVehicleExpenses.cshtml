@model AuctionInventory.Models.Purchase
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div id="boxbody" style="width:90%; margin:0px auto" class="tablecontainer">
    <div class="box-body">
        <div id="divDetails" class="row">
           
            <div class="col-sm-6">
                <div class="form-group">
                    <label>Purchase Inv No: </label>
                    @*<label>Purchase Inv No:PUR-@(@DateTime.Now.Year % 100)-<span id="invno"></span></label>*@
                    @Html.TextBoxFor(a => a.iPurchaseInvoiceNo, new { @class = "form-control", @id = "invno" })

                </div>
                <input type="button" value="ADD" id="JQGridFill" class="btn btn-success" />
            </div>



            <div class="row" id="divParsedExcel" style="display:none">

                <table id="dataGrid" class="table table-bordered table-striped"></table>
                <div id="pagingGrid"></div>

            </div>

        </div>
    </div>
</div>



<script type="text/javascript">
    $("#JQGridFill").click(function () {
        debugger
        var request = $('#invno').val();

        $.ajax({
            
            url: "/MExpenses/VehiclesByInvoiceID",          
            data: JSON.stringify({ request: request }),
            dataType: "json",
            type: "POST",
            contentType: "application/json; charset=utf-8",
            success: function (result) {

                alert("Done");
         
                var VehicleByInvoice = result.VehicleByInvoice


                bindGrid(listVehicle);


            }
        });

        function bindGrid(listVehicle) {


            var lastsel;
            $('#dataGrid').jqGrid({
                // Comment and uncomment below lines for ajax and local data

                url: '/MVehicle/GetData/',
                datatype: "json",
                contentType: "application/json; charset-utf-8",
                mtype: 'GET',

                caption: "Invoice Discription",
                data: listVehicle,
                datatype: "local",
                // colNames: ['Action', 'Lot No', 'Chasis No', 'Model', 'Year', 'Color', 'JPY', 'Assessed Value', 'AED'],
                colNames: ['ID','Lot No', 'Chasis No','Make', 'Model','Category', 'Year', 'Color','Origin','Location', 'CustomAssessed Value','Duty', 'JPY'],
                colModel: [
                    { name: 'iVehicleID', index: 'iVehicleID',hidden: true, editable: true, editrules: { edithidden: false }, hidedlg: true },
                    { name: 'iLotNum', index: 'iLotNum', editable: true },
                    { name: 'strChassisNum', index: 'strChassisNum', editable: true },
                    { name: 'strMake', index: 'strMake', editable: true },
                    { name: 'iModel', index: 'iModel', editable: true },
                    { name: 'strCategory', index: 'strCategory', editable: true },
                    { name: 'iYear', index: 'iYear', editable: true },
                    { name: 'strColor', index: 'strColor', editable: true },
                    { name: 'strOrigin', index: 'strOrigin', editable: true },
                    { name: 'strLocation', index: 'strLocation', editable: true },
                    { name: 'iCustomAssesVal', index: 'iCustomAssesVal', editable: true },
                    { name: 'iDuty', index: 'iDuty', editable: true },
                    { name: 'iCustomValInJPY', index: 'iCustomValInJPY', editable: true }


                ],
                width: 1050,
                height: 250,
                rowNum: 10,
                //loadonce: true,
                rowList: [10, 20, 30],
                pager: 'pagingGrid',
                editurl: '/MVehicle/Save/',
                //editurl: 'TemplateCategoryWebView.jsp',
                //caption: 'Select Invoice to edit',
                //cellEdit: true,
                cellsubmit: 'clientArray',
                onSelectRow: function (id) {

                    if (id !== lastsel) {


                        jQuery('#dataGrid').jqGrid('saveRow', lastsel);

                        lastsel = id;

                    }
                    jQuery('#dataGrid').jqGrid('editRow', id, true);
                    return true;

                },


            });
            jQuery("#dataGrid").jqGrid('filterToolbar', { stringResult: true, searchOnEnter: false, defaultSearch: "cn" });
            jQuery("#dataGrid").jqGrid('navGrid', '#pagingGrid', { edit: false, add: false, del: false, search: false, rel: false });

        }
    });

    function SaveRow(id) {
        debugger;
        var griddata = $('#dataGrid').jqGrid('getGridParam', 'data');
        //var vehicles = jQuery('#dataGrid').jqGrid ('getRowData', id);
        //var griddata = jQuery("#dataGrid").getRowData();
        //var ID=id-1;
        //var vehicle= griddata;
        var vehicle=  griddata[id-1];


        ////Now goes ur ajax
        //$.ajax({
        //    url: '/MVehicle/Save/',
        //    data: JSON.stringify({ vehicle:vehicle  }),
        //    //data: {vehicle:vehicle },
        //    type: "post",
        //    cache: false,
        //    success: function (Status) {
        //        alert("Update Data Successfully!!!!");
        //    },
        //    error: function (xhr, ajaxOptions, thrownError) {
        //        alert("Not able to Update Data !!!!");
        //    }
        //});
        $.ajax({
            type: "POST",
            url: '/MVehicle/Save/',
            cache: false,
            data: JSON.stringify({vehicle: vehicle }),
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (Data) {
                //window.location.href = "/TPurchase/Index";

                if (Data.status) {

                    alert("Data Saved");
                }

            },
            error: function (data) {
                alert("Not able to Update Data !!!!");
            }
        });

    }
</script>



<!-- JqGrid Scripts -->
<link href="~/scripts/jquery-ui-1.9.2.custom.css" rel="stylesheet" />
<link href="~/scripts/ui.jqgrid.css" rel="stylesheet" />
<script src="~/Scripts/jQuery-migrate-1.2.1-min.js"></script>
<script src="~/scripts/jQuery-migrate-1.2.1.js"></script>
<script src="~/scripts/grid.locale-en.js"></script>
<script src="~/scripts/jquery.jqgrid.min.js"></script>